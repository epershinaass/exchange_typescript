# Авторизация

Date: 2022-07-14

## Status

Предложен

## Context

Создать сущность пользователя для хранения аккаунтов в базе для биржи.
Создать сущность токена для хранения refreshToken
Создать модуль авторизации для безопасности роутов.
Написать методы создания токенов.
Используемые технологии: Nestjs, MongoDb, Grpc, Kafkajs, JWT

## Decision

Проект будет состоять из двух модулей: auth, users

В модуле users: 
храниться сущность пользователя ввиде коллекции монго с полями: _id,login,hashPassword;
метод создания пользователя,в котором будет хэшироваться пароль и генерироваться jwt токен

В модуле auth:
метод логина: проверка на получение пользователя,если его нет в базе,то выкидываем ошибку,в противном случае получаем пароль,декодируем его и сверяем с hashPassword, если они равны,то пользователь залогинен.

Примерный выбор описания контракта для обмена сообщениями между микросервисами:

```js

export class LoginDto {
    login:string;
    password:string
}

export interface IKafkaMessage<LoginDto> {
    topic:string;
    value: LoginDto;
}
```

В качестве стратегии авторизации будем использовать jwt, поскольку:
1) Jwt токены содержат данные пользователя и нам не нужно будет каждый раз запрашивать эту информацию у сервера
2) Хорошая безопасность благодаря цифровой подписи
3) Быстрая проверка, ввиду того что токены не требуют поиска в базе

## Consequences

Минусы jwt авторизации:
1) Сложно отозвать токены, нужно писать дополнительные методы
2) Если будет украден секретный ключ, то злоумышленник может создавать свои действительные jwt и что позволит 
подделать любого пользователя в приложении

## Author 
https://github.com/Yura195

https://github.com/mskuratova